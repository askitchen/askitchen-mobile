<template>
  <div class="page">
    <div class="navbar">
      <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="icon icon-back"></i>
            <span class="ios-only">Back</span>
          </a>
        </div>
        <div class="title">{{data.nama}}</div>
        <div class="right">
          <a href="/cart/" data-view=".view-main" class="link icon-only panel-close ac-more1">
            <i class="icon f7-icons ios-only">shopping_cart<span class="badge color-red"></span></i>
            <i class="icon material-icons md-only">shopping_cart<span class="badge color-red"></span></i>
          </a>
        </div>
      </div>
    </div>
    <div class="page-content">
        
      <div class="block header">
        <div data-pagination='{"el": ".swiper-pagination"}' class="swiper-container swiper-init swiper-detail">
          <div class="swiper-pagination detail"></div>
          <div class="swiper-wrapper"> <!-- image https://askitchen.com/upload/gambar/ -->
            <div class="swiper-slide"><span class="img-helper"></span><img class="lazy product" src="http://localhost/askitchenweb/upload/gambar/{{data.gambar}}" /></div>
            <div class="swiper-slide"><span class="img-helper"></span><img class="lazy product" src="http://localhost/askitchenweb/upload/gambar/{{#if data.gambar2}}{{data.gambar2}}{{else}}{{data.gambar}}{{/if}}" /></div>
            <div class="swiper-slide"><span class="img-helper"></span><img class="lazy product" src="http://localhost/askitchenweb/upload/gambar/{{#if data.gambar3}}{{data.gambar3}}{{else}}{{data.gambar}}{{/if}}" /></div>
          </div>
        </div>
      </div>
      
      <div class="card item-detail">
        <input type="hidden" class="item-code"    value="{{data.kdbar}}" />
        <input type="hidden" class="item-name"    value="{{data.nama}}" />
        <input type="hidden" class="item-price"   value="{{data.hjual}}" />
        <input type="hidden" class="item-picture" value="{{data.gambar}}" />
        <input type="hidden" class="last-value"   value="{{data.stok}}" />
        <input type="hidden" class="item-qty"     value="1">
        
        <input type="hidden" id="maxqty" value="{{data.stok}}">
        <input type="hidden" id="minqty" value="">

        <div class="card-footer detail">
          <div class="product-name">{{data.nama}}</div>
          {{#if data.stok}}
          <div class="stock-avail">Stock Available</div>
          {{/if}}
        </div>
        <div class="card-footer detail">
          <div class="product-price">Rp{{data.hjualf}}</div>
          <div class="product-price">
            {{#if data.stok}}
            <a href="#" class="button-add"><img src="img/cart.png" class="cart-img" /><span class="cart-label">Add To Cart</span></a>
            {{else}}
            <a href="#" class="button-coming"><span class="cart-label">Coming soon!</span></a>
            {{/if}}
          </div>
        </div>
        {{#if data.pnj}}
        <div class="product-size2">{{data.pnj}} x {{data.lbr}}{{#if data.tgi}} x {{data.tgi}}{{/if}}</div>
        {{/if}}
        <div class="product-code2">{{data.kdbar}}</div>
        <span id="rater" class="rating golden" data-default-rating="3"></span>
        <!-- <div class="starbox">
          <i class="f7-icons">star_fill</i>
          <i class="f7-icons">star_fill</i>
          <i class="f7-icons">star_fill</i>
          <i class="f7-icons">star</i>
          <i class="f7-icons">star</i>
        </div> -->
      </div>

      <div class="block">
        <div class="block-title detail">Description</div>
        <p class="product-desc">{{data.deskripsi}}</p>
      </div>
      
      <div class="block">
        <div class="block-title detail">Reviews</div>
        <div class="list media-list">
          <ul>
          {{#each data.reviews}}
            <li>
              <div class="item-content">
                <div class="item-media"><img class="img-review" src="img/user.png"></div>
                <div class="item-inner">
                  <div class="item-title-row">
                    <div class="item-title rev-name">{{name}}</div>
                  </div>
                  <div class="item-text">{{comment}}</div>
                </div>
              </div>
            </li>
          {{/each}}
          </ul>
        </div>
      </div>
    
      <div class="block">
        <div class="block-title detail">Related Products</div>
        <div data-space-between="10" data-slides-per-view="3" class="swiper-container swiper-init swiper-related">
          <!-- <div class="swiper-pagination"></div> -->
          <div class="swiper-wrapper">
            
            {{#each data.related}}
            <div class="swiper-slide detail">
              <a href="/detail/{{kdurl}}" class="item-link">
              <div>
                <img class="responsive-product lazy" src="http://localhost/askitchenweb/upload/gambar/{{gambar}}" />
                <!-- image https://askitchen.com/upload/gambar/ -->
              </div>
              <div class="product-name-rel">{{nama}}</div>
              <div class="product-price-rel">Rp{{hjual}}</div>
              {{#if pnj}}
              <div class="product-size-rel">{{pnj}} x {{lbr}}{{#if tgi}} x {{tgi}}{{/if}}</div>
              {{/if}}
              <div class="product-code-rel">{{kdbar}}</div>
              <img class="button-buy" src="img/beli.png" /></a>
            </div>
            {{/each}}

          </div>
        </div>
      </div>
      <!-- <div class="content-block"><a href="#" class="button button-raised button-fill larger btn-buy">Buy it now</a></div>
      <div class="content-block"><a href="#" class="button button-raised larger btn-cart">Add to cart</a></div>
      <div class="content-block"><a href="#" class="button button-raised larger btn-wish">Add to wish list</a></div> -->
    </div>
  </div>
</template>
<script>
  return {
    // Page Events
    on: {
      
      pageBeforeIn: function (event, page) {
        
      //   app.request.get("http://localhost/askitchenweb/api/v1/cart/total_items", function(res) {
          
      //     var data = JSON.parse(res);

      //     if (data.status)
      //     {
      //       app.data.total_items = data.totqty;
      //       // $$('.badge').text(app.data.total_items);
      //     }
      //   });
        
        if (app.data.total_items > 0) {
          $$('.badge').text(app.data.total_items);
          $$('.badge').css("display", "block");
        } else {
          $$('.badge').css("display", "none");
        }
      },

      pageInit: function(e, page) {

        // var starRating = new SimpleStarRating($$('#rater'));

        $$('.page-content').on('scroll', function (e) {
          // var scrollTop = e.srcElement.scrollTop;
          var scrollTop = $$('.card.item-detail').offset().top;
          var card = $$('.card.item-detail');
          
          // console.log(scrollTop)
          // if (scrollTop >= 56) {
          //   card.removeClass("sticky")
          // } else {
          //   card.addClass("sticky");
          // }
        })

        $$('.button-add').on('click', function (e) {
          
          if (!app.data.bLogedIn) {
            
            // app.data.lastURL = app.views.main.router.url;
            // console.log('Current url: ' + app.views.main.router.url)

            app.router.navigate('/login/', {
              reloadCurrent: true,
              ignoreCache: true,
            });
            return;
          }

          var card  = $$('.item-detail');
          var kode  = card.find('.item-code').val();
          var qty   = card.find('.item-qty').val();
          
          var formData = [];

          formData.kode = kode;
          formData.qty  = qty;
          // formData.Authorization = app.data.token;

          app.request.post("http://localhost/askitchenweb/api/v1/cart", formData, function(res) {
              
            var data = JSON.parse(res);

            if (data.status)
            {
              app.data.total_items = data.totqty;
              $$('.badge').text(data.totqty);
              $$('.badge').css("display", "block");
            }
          });
        });
      }
    }
  }
</script>
